{% extends 'students/base.html' %}

{% load static from staticfiles %}
{% load crispy_forms_tags %}

{% block meta_title %} Облік Відвідування {% endblock meta_title %}

{% block title %} Облік Відвідування {% endblock title %}

{% block logo %} 

	     <!-- Logo -->
		 <div class="col-xs-8">
		   <h1> Сервіс Обліку Студентів </h1>
		 </div>
		  
{% endblock logo %}

{% block group_selector %}
    <!-- Groups Selector -->
  <div class="col-xs-4" id="group-selector">
        <strong>Група:</strong>
        <select class="custom-select">
              <option value="" >Усі Групи </option>
              {% for group in GROUPS %}
        <option value="{{ group.id }}"{% if group.selected %} selected="1"{% endif %}> {{ group.title }}{% if group.leader %}, {{ group.leader }}{% endif %}</option>
        {% endfor %}
        
      </select>
      </div>    
{% endblock group_selector %}

{% block status_message %}
   
    {% if not students %}
    
    <div class='alert alert-waring' role="alert">
      Поки немає жодного студента в базі. Будь-ласка, 
      <a href="{% url 'students_add' %}"> додайте </a> першого.
    </div>
    
    {% endif %}
{% endblock %}

{% block content %}	
  {% if not students %}
    <div class="alert alert-warning">
    	Поки немає жодного студента в базі. Будь-ласка,
    	<a href="{% url 'students_add' %}"> додайте </a> першого.
    </div>

  {% else %}

  <div class="alert alert-warning" id="downloading">
    Зміни в журналі зберігаються автоматично при кожному кліку в клітинці таблиці.
    <span id="ajax-progress-indicator"> Йде збереження... </span>

  </div>
  <div class="alert alert-danger" id="error-status">
  	
  </div>

  <p id="journal-nav" class="text-center"> 
    <a href="?month={{ prev_month }}"
       title="Попередній Місяць">&larr;</a>
    <!-- TODO: translate month name -->
    <strong>{{ month_verbose }} {{ year }}</strong>
    <a href="?month={{ next_month }}"
       title="Наступний Місяць">&rarr;</a>
  </p>

  <table class="table table-hover table-striped table-bordered"
         id="students-journal">

    <thead>
    	<tr class="header">
    	  <th class="num">#</th>
    	  <th class="name">Студент</th>
    	  {% for day in month_header %}
          <th class="day-header">
          	<!-- TODO: translate day name -->
          	{{ day.verbose }}
          	<br />
          	{{ day.day }}
          </th>
    	  {% endfor %}
    	</tr>
    </thead>

    <tbody>
    	
      {% csrf_token %}
      
      {% for student in students %}
      <tr>
      	
      	<td>
      	  {% if is_paginated %}
            {{ page_obj.start_index|add:forloop.counter|add:"-1" }}
          {% else %}
            {{ forloop.counter }}
      	  {% endif %}
      	</td>
        
        <td>
          <a title="Редагувати" 
             href="{% url 'students_edit' student.id %}" class="modal-form-link">
               {{ student.fullname }}
             </a>
        </td>

        {% for day in student.days %}
         <td class="day-box">
         	<input type="checkbox" 
         	       data-student-id="{{ student.id }}" 
         	       data-date="{{ day.date }}" 
         	       data-url="{{ student.update_url }}" 
         	       value="1"
         	       {% if day.present %} checked="checked" {% endif %}>
         	
         </td>
        {% endfor %}

      </tr>
      {% endfor %}
    </tbody>
  	
  </table>
  {% endif %}

  {% with object_list=students %}
    {% include "students/pagination_journal.html" %}
  {% endwith %}

{% endblock content %}
